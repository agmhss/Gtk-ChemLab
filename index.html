<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Gtk – Virtual Chemistry Lab V3</title>
<style>
  :root{
    --bg:#e6f7f3;
    --card:#ffffff;
    --accent:#00796b;
    --muted:#607d8b;
    --pill:#e0f7f5;
    --glass: rgba(255,255,255,0.6);
  }
  *{box-sizing:border-box}
  body{
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    margin:0;
    background: linear-gradient(180deg,var(--bg),#f1fbf8);
    color:#1f2d2b;
    display:flex;
    justify-content:center;
    padding:28px;
    min-height:100vh;
  }

  .app {
    width:100%;
    max-width:1000px;
    background:var(--card);
    border-radius:14px;
    box-shadow:0 12px 30px rgba(0,0,0,0.12);
    padding:22px;
    overflow:hidden;
  }

  header{
    display:flex;
    gap:18px;
    align-items:center;
    margin-bottom:16px;
  }
  .logo {
    background:var(--pill);
    border-radius:12px;
    padding:12px;
    display:flex;
    align-items:center;
    justify-content:center;
    width:64px;height:64px;
    box-shadow:inset 0 1px 0 rgba(255,255,255,0.6);
  }
  h1{font-size:1.4rem;margin:0;color:var(--accent)}
  p.lead{margin:0;color:var(--muted);font-size:0.95rem}

  .grid {
    display:grid;
    grid-template-columns:360px 1fr;
    gap:18px;
    align-items:start;
  }

  .panel {
    background: linear-gradient(180deg, rgba(255,255,255,0.8), rgba(255,255,255,0.95));
    border-radius:10px;
    padding:14px;
    border:1px solid rgba(0,0,0,0.03);
  }

  .select-group {
    display:flex;
    flex-direction:column;
    gap:12px;
    margin-bottom:12px;
  }

  label.small{font-size:0.85rem;color:var(--muted);margin-bottom:6px}
  select, .btn {
    width:100%;
    padding:10px 12px;
    border-radius:8px;
    border:1px solid #cfd8d7;
    font-size:1rem;
    background:transparent;
    outline:none;
  }

  .btn {
    background: linear-gradient(90deg,#00bcd4,#00acc1);
    color:#fff;border:none;cursor:pointer;font-weight:600;
    margin-top:8px;padding:12px;
  }
  .btn:active{transform:translateY(1px)}
  .helpers{font-size:0.86rem;color:var(--muted);margin-top:6px}

  /* visual lab column */
  .lab-area{
    display:flex;
    flex-direction:column;
    gap:12px;
    align-items:center;
  }

  .test-tube-wrap{
    width:220px;
    display:flex;
    justify-content:center;
    margin-top:6px;
  }
  .test-tube {
    width:84px;
    height:260px;
    border:4px solid rgba(90,90,90,0.25);
    border-top-left-radius:28px;
    border-top-right-radius:28px;
    border-bottom-left-radius:42px;
    border-bottom-right-radius:42px;
    background:linear-gradient(180deg, rgba(255,255,255,0.6), rgba(255,255,255,0.2));
    position:relative;
    overflow:hidden;
    box-shadow:0 8px 18px rgba(0,0,0,0.08), inset 0 6px 18px rgba(255,255,255,0.35);
    transition:transform .25s ease;
  }

  .liquid {
    position:absolute;
    left:0;right:0;bottom:0;
    height:56%;
    background:#add8e6;
    transition:height .45s ease, background-color .6s ease;
  }
  .precip {
    position:absolute;
    left:0;right:0;bottom:0;
    height:0%;
    opacity:0;
    transition:height 1.1s ease, opacity .9s ease, background-color .5s ease;
    border-top-left-radius:22px;
    border-top-right-radius:22px;
  }

  .tube-animate{animation:shake .35s cubic-bezier(.36,.07,.19,.97) both;}

  @keyframes shake{
    10%,90%{ transform: translate3d(-2px,0,0) }
    20%,80%{ transform: translate3d(4px,0,0) }
    30%,50%,70%{ transform: translate3d(-6px,0,0)}
    40%,60%{ transform: translate3d(6px,0,0)}
  }

  .results {
    width:100%;
    padding:12px;
    border-radius:10px;
    background:linear-gradient(180deg,#f7fffe,#f1fbfa);
    border:1px dashed rgba(0,120,100,0.06);
    margin-top:6px;
  }
  .equation {
    font-weight:700;color:#045d53;font-size:1.05rem;background:rgba(224,255,250,0.7);padding:8px;border-radius:6px;margin-bottom:8px;overflow:auto;
  }
  .observation{font-size:0.98rem;color:#333}

  .meta-row {display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
  .chip{background:var(--pill);padding:6px 10px;border-radius:999px;font-weight:600;color:var(--accent);font-size:0.88rem}

  footer{margin-top:14px;font-size:0.82rem;color:var(--muted);}

  /* responsive */
  @media (max-width:900px){
    .grid{ grid-template-columns:1fr; }
    .test-tube-wrap{ justify-content:flex-start; }
  }
</style>
</head>
<body>
  <div class="app" role="application" aria-label="Virtual Chemistry Lab V3">
    <header>
      <div class="logo" aria-hidden="true">
        <svg width="34" height="34" viewBox="0 0 24 24"><path fill="#00796b" d="M8 2v6l-6 8h16l-6-8V2z"/></svg>
      </div>
      <div>
        <h1>Gtk – Virtual Chemistry Lab V3</h1>
        <p class="lead">Aqua-Mint theme · 12 salts included · reactions and observations matched to textbook tests. </p>
      </div>
    </header>

    <div class="grid">
      <!-- controls column -->
      <div class="panel" aria-label="Controls">
        <div class="select-group">
          <div>
            <label class="small">Select Cation Salt (Solution)</label>
            <select id="cationSelect" aria-label="Cation selection">
              <option value="">-- Choose Salt / Cation --</option>

              <!-- Group 1: Lead -->
              <optgroup label="Lead">
                <option value="Pb(NO3)2">Lead nitrate — Pb(NO₃)₂</option>
              </optgroup>

              <!-- Copper -->
              <optgroup label="Copper">
                <option value="CuSO4">Copper sulfate — CuSO₄</option>
                <option value="CuCO3">Copper carbonate — CuCO₃</option>
              </optgroup>

              <!-- Iron -->
              <optgroup label="Iron">
                <option value="FeSO4">Ferrous sulfate — FeSO₄ (Fe²⁺)</option>
                <option value="FeCl3">Ferric chloride — FeCl₃ (Fe³⁺)</option>
              </optgroup>

              <!-- Aluminium -->
              <optgroup label="Aluminium">
                <option value="Al2(SO4)3">Aluminium sulfate — Al₂(SO₄)₃</option>
                <option value="Al(NO3)3">Aluminium nitrate — Al(NO₃)₃</option>
              </optgroup>

              <!-- Zinc -->
              <optgroup label="Zinc">
                <option value="ZnSO4">Zinc sulfate — ZnSO₄</option>
                <option value="ZnS">Zinc sulphide — ZnS</option>
              </optgroup>

              <!-- Calcium / Barium / Magnesium / Silver -->
              <optgroup label="Alkaline / Others">
                <option value="CaCO3">Calcium carbonate — CaCO₃</option>
                <option value="BaCl2">Barium chloride — BaCl₂</option>
                <option value="MgSO4">Magnesium sulfate — MgSO₄</option>
                <option value="AgNO3">Silver nitrate — AgNO₃</option>
              </optgroup>
            </select>
            <div class="helpers">Salt choice influences liquid color to help recognition (Cu → blue, Fe²⁺ → green, Fe³⁺ → brownish).</div>
          </div>

          <div>
            <label class="small">Select Reagent</label>
            <select id="reagentSelect" aria-label="Reagent selection">
              <option value="">-- Choose Reagent --</option>
              <option value="NaOH">Sodium hydroxide — NaOH</option>
              <option value="KOH">Potassium hydroxide — KOH</option>
              <option value="NH4OH">Ammonium hydroxide — NH₄OH</option>
              <option value="KI">Potassium iodide — KI</option>
              <option value="Na2SO4">Sodium sulfate — Na₂SO₄</option>
              <option value="BaCl2">Barium chloride — BaCl₂</option>
              <option value="AgNO3">Silver nitrate — AgNO₃</option>
              <option value="HCl">Hydrochloric acid — HCl</option>
              <option value="Na2CO3">Sodium carbonate — Na₂CO₃</option>
            </select>
            <div class="helpers">Choose a reagent commonly used in textbook tests (precipitation, halide, sulfate, carbonate, etc.).</div>
          </div>

          <button class="btn" id="mixBtn">Mix in Test Tube</button>
        </div>

        <div class="meta-row">
          <div class="chip">12 salts</div>
          <div class="chip">Textbook-matched observations</div>
          <div class="chip">Aqua-Mint theme</div>
        </div>
      </div>

      <!-- lab / visualization column -->
      <div class="panel lab-area">
        <div style="display:flex;justify-content:space-between;gap:12px;width:100%;align-items:center">
          <div>
            <strong>Test tube</strong>
            <div style="font-size:0.86rem;color:var(--muted)">Shake to simulate mixing. Precipitate grows from bottom.</div>
          </div>
          <div style="text-align:right">
            <small style="color:var(--muted)">Click Mix → wait ~0.6s for animation</small>
          </div>
        </div>

        <div class="test-tube-wrap" aria-hidden="false">
          <div id="testTube" class="test-tube" role="img" aria-label="Test tube with solution">
            <div id="liquid" class="liquid"></div>
            <div id="precip" class="precip"></div>
          </div>
        </div>

        <div class="results" aria-live="polite">
          <div id="equation" class="equation">Reactant 1 + Reactant 2 → Products</div>
          <div class="observation"><strong>Observation:</strong> <span id="obsText">Select two chemicals and click Mix.</span></div>
        </div>

        <footer>
          Reaction data & observations referenced to the uploaded textbook of simple salts analysis. 
        </footer>
      </div>
    </div>
  </div>

<script>
/* ---------- Helper: format chemical formulas (simple) ---------- */
function formatChem(text){
  // convert numbers to subscript and arrow symbol
  return String(text)
    .replace(/->/g,' → ')
    .replace(/([A-Za-z)\]])(\d+)/g, '$1' + '<sub>$2</sub>')
    .replace(/\(s\)/g,'<i style="font-size:0.88em;color:#666">(s)</i>');
}

/* ---------- Reaction database (covers many common textbook tests) ----------
   All 12 salts included; reagents include NaOH, KOH, NH4OH, KI, Na2SO4, BaCl2, AgNO3, HCl, Na2CO3.
   Observations (color / behaviour) chosen to match textbook-style descriptions. ---------- */

const reactions = {
  // SILVER
  'AgNO3_NaCl': { equation: "AgNO3 + NaCl -> AgCl(s) + NaNO3", observation:"Curdy white precipitate (AgCl) forms; insoluble in dilute NH4OH.", visual:{liquid:'#f7fafc', precip:'#F5F5F5'} },
  'AgNO3_NaOH': { equation: "2AgNO3 + 2NaOH -> Ag2O(s) + H2O + 2NaNO3", observation:"Brown/black precipitate (Ag2O) appears on standing.", visual:{liquid:'#ffffff', precip:'#8B4513'} },

  // COPPER
  'CuSO4_NaOH': { equation: "CuSO4 + 2NaOH -> Cu(OH)2(s) + Na2SO4", observation:"Light/bright blue gelatinous precipitate (Cu(OH)2); may dissolve in excess NH4OH producing deep blue complex.", visual:{liquid:'#bfe9ff', precip:'#00BFFF'} },
  'CuSO4_NH4OH': { equation: "CuSO4 + 4NH4OH -> [Cu(NH3)4]SO4 (aq) + ...", observation:"Blue precipitate initially; in excess NH4OH dissolves to deep blue ammine complex.", visual:{liquid:'#4f93b6', precip:'#00BFFF'} },
  'CuCO3_HCl': { equation: "CuCO3 + 2HCl -> CuCl2(aq) + CO2(g) + H2O", observation:"Effervescence (CO2) and carbonate dissolves; solution becomes blue (Cu²⁺).", visual:{liquid:'#afd6e6'} },

  // LEAD
  'Pb(NO3)2_KI': { equation: "Pb(NO3)2 + 2KI -> PbI2(s) + 2KNO3", observation:"Striking yellow crystalline precipitate (PbI2) forms immediately.", visual:{liquid:'#fffaf0', precip:'#FFD700'} },
  'Pb(NO3)2_Na2SO4': { equation: "Pb(NO3)2 + Na2SO4 -> PbSO4(s) + 2NaNO3", observation:"White, dense precipitate (PbSO4).", visual:{liquid:'#fffaf0', precip:'#F5F5F5'} },
  'Pb(NO3)2_NaOH': { equation: "Pb(NO3)2 + 2NaOH -> Pb(OH)2(s) + 2NaNO3", observation:"Chalky white precipitate (Pb(OH)2) forms.", visual:{liquid:'#fffaf0', precip:'#F5F5F5'} },

  // BARIUM
  'BaCl2_Na2SO4': { equation: "BaCl2 + Na2SO4 -> BaSO4(s) + 2NaCl", observation:"Dense white precipitate (BaSO4) — confirms sulphate.", visual:{liquid:'#e6f7ff', precip:'#ffffff'} },
  'BaCl2_Na2CO3': { equation: "BaCl2 + Na2CO3 -> BaCO3(s) + 2NaCl", observation:"White precipitate (BaCO3) — carbonates give effervescence on acid.", visual:{liquid:'#e6f7ff', precip:'#ffffff'} },

  // IRON(II) - FERROUS
  'FeSO4_NaOH': { equation: "FeSO4 + 2NaOH -> Fe(OH)2(s) + Na2SO4", observation:"Dirty-green precipitate (Fe(OH)2) appears; on standing it may oxidize to brown.", visual:{liquid:'#dff2ea', precip:'#3CB371'} },

  // IRON(III) - FERRIC
  'FeCl3_NaOH': { equation: "FeCl3 + 3NaOH -> Fe(OH)3(s) + 3NaCl", observation:"Reddish-brown precipitate (Fe(OH)3) forms — characteristic.", visual:{liquid:'#faf8f6', precip:'#A52A2A'} },
  'FeCl3_NH4OH': { equation: "FeCl3 + 3NH4OH -> Fe(OH)3(s) + 3NH4Cl", observation:"Reddish brown precipitate; insoluble in excess.", visual:{liquid:'#faf8f6', precip:'#A52A2A'} },

  // ALUMINIUM
  'Al2(SO4)3_NaOH': { equation: "Al2(SO4)3 + 6NaOH -> 2Al(OH)3(s) + 3Na2SO4", observation:"White gelatinous precipitate (Al(OH)3); amphoteric — dissolves in excess NaOH.", visual:{liquid:'#fdfefe', precip:'#F8F8FF'} },
  'Al(NO3)3_NH4OH': { equation: "Al(NO3)3 + 3NH4OH -> Al(OH)3(s) + 3NH4NO3", observation:"White gelatinous precipitate (Al(OH)3).", visual:{liquid:'#fdfefe', precip:'#F8F8FF'} },

  // ZINC
  'ZnSO4_NaOH': { equation: "ZnSO4 + 2NaOH -> Zn(OH)2(s) + Na2SO4", observation:"White precipitate (Zn(OH)2) forms; dissolves in excess NaOH (forms soluble zincate).", visual:{liquid:'#f6fbff', precip:'#ffffff'} },
  'ZnS_HCl': { equation: "ZnS + 2HCl -> H2S(g) + ZnCl2", observation:"Rotten-egg smelling gas (H2S) evolves — sulphide present.", visual:{liquid:'#f6fbff'} },

  // CALCIUM
  'CaCO3_HCl': { equation: "CaCO3 + 2HCl -> CaCl2 + CO2(g) + H2O", observation:"Brisk effervescence (CO2) — carbonate confirmed; limewater turns milky.", visual:{liquid:'#fffdf2'} },

  // MAGNESIUM
  'MgSO4_BaCl2': { equation: "MgSO4 + BaCl2 -> BaSO4(s) + MgCl2", observation:"White precipitate (BaSO4) forms when tested for sulfate.", visual:{liquid:'#f7fbff', precip:'#ffffff'} },

  // COPPER SULFATE with carbonate test (dehydration on heating described in book)
  'CuSO4_heat': { equation: "CuSO4·5H2O (heat) -> CuSO4 (white/anhydrous) + 5H2O(g)", observation:"Blue hydrated copper sulphate loses water on heating, turning pale/white (anhydrous).", visual:{liquid:'#bfe9ff'} },

  // COMMON NO REACTION (fallback)
  'DEFAULT_NR': { equation: "Reactant 1 + Reactant 2 -> No observable change", observation:"No visible change — most species remain soluble / no precipitate.", visual:{noReaction:true} }
};

/* ---------- UI elements ---------- */
const cation = document.getElementById('cationSelect');
const reagent = document.getElementById('reagentSelect');
const mixBtn = document.getElementById('mixBtn');
const tube = document.getElementById('testTube');
const liquidEl = document.getElementById('liquid');
const precipEl = document.getElementById('precip');
const eqEl = document.getElementById('equation');
const obsEl = document.getElementById('obsText');

/* map salt -> default liquid color to help visual recognition */
const cationColor = {
  'AgNO3':'#f7fbfb',
  'CuSO4':'#bfe9ff',
  'CuCO3':'#cdeef0',
  'Pb(NO3)2':'#fffaf0',
  'BaCl2':'#f0fff9',
  'FeSO4':'#e6f9ef',
  'FeCl3':'#fbf3f0',
  'NaCl':'#fff',
  'KNO3':'#fff',
  'Al2(SO4)3':'#f8fffd',
  'Al(NO3)3':'#fbfffd',
  'ZnSO4':'#f7fbff',
  'ZnS':'#f7fbff',
  'CaCO3':'#fffdf2',
  'MgSO4':'#f7fbff'
};

/* Helper to look up reaction by both orders */
function lookupReaction(a,b){
  if(!a || !b) return reactions['DEFAULT_NR'];
  const key1 = `${a}_${b}`;
  const key2 = `${b}_${a}`;
  return reactions[key1] || reactions[key2] || reactions['DEFAULT_NR'];
}

/* Animate & display result */
function showResult(result, saltKey){
  // reset states
  tube.classList.remove('tube-animate');
  precipEl.style.height = '0%';
  precipEl.style.opacity = '0';
  precipEl.style.backgroundColor = 'transparent';
  liquidEl.style.backgroundColor = cationColor[saltKey] || '#add8e6';

  // small shake
  tube.classList.add('tube-animate');

  // after short delay reveal precipitate / colors
  setTimeout(()=>{
    if(result.visual && result.visual.noReaction){
      // subtle flash border to indicate no reaction
      tube.style.boxShadow = '0 0 18px rgba(255,92,92,0.12)';
      setTimeout(()=> tube.style.boxShadow = '0 8px 18px rgba(0,0,0,0.08)', 700);
    } else {
      // liquid color
      if(result.visual && result.visual.liquid){
        liquidEl.style.backgroundColor = result.visual.liquid;
      }

      // precipitate
      if(result.visual && result.visual.precip){
        precipEl.style.backgroundColor = result.visual.precip;
        precipEl.style.height = '22%';
        precipEl.style.opacity = '1';
      } else if(result.visual && result.visual.precipitate){
        precipEl.style.backgroundColor = result.visual.precipitate;
        precipEl.style.height = '22%';
        precipEl.style.opacity = '1';
      } else if(!result.visual){
        // default small white ppt if equation contains (s)
        if((result.equation || '').includes('(s)') || (result.equation || '').includes('->') ){
          precipEl.style.backgroundColor = '#ffffff';
          precipEl.style.height = '18%';
          precipEl.style.opacity = '1';
        }
      }
    }

    // set equation and observation
    eqEl.innerHTML = formatChem(result.equation || '—');
    obsEl.innerHTML = result.observation || '—';
  }, 380);
}

/* Format function for display */
function formatChem(txt){
  return txt
    .replace(/->/g,' → ')
    .replace(/([A-Za-z\)\]])(\d+)/g, '$1' + '<sub>$2</sub>')
    .replace(/\(s\)/g,'<i style="font-size:0.85em;color:#666">(s)</i>');
}

/* On mix */
mixBtn.addEventListener('click', ()=>{
  const s = cation.value;
  const r = reagent.value;

  // handle empty selections
  if(!s || !r){
    eqEl.innerHTML = 'Select both a salt and a reagent to mix.';
    obsEl.textContent = 'Pick two chemicals, then click Mix.';
    tube.classList.add('tube-animate');
    setTimeout(()=> tube.classList.remove('tube-animate'), 600);
    return;
  }

  const result = lookupReaction(s,r);

  // show initial liquid color immediate
  liquidEl.style.backgroundColor = cationColor[s] || '#add8e6';

  // show result (animation + content)
  showResult(result, s);
});

/* Accessibility: allow Enter on select to trigger mixing */
[cation, reagent].forEach(el=>{
  el.addEventListener('keydown', (ev)=>{
    if(ev.key === 'Enter'){ mixBtn.click(); }
  });
});

/* Pre-fill simple example on load for users */
document.addEventListener('DOMContentLoaded', ()=>{
  // nothing auto-picked to encourage user action; you can pre-select if wanted
});
</script>
</body>
    </html>
